version: '3.7'

services:
    api:
        image: gcr.io/audio-274519/api:v1.0.4
        container_name: api
        restart: unless-stopped
        environment:
            - VIRTUAL_HOST=api.shareaudio.cc
            - LETSENCRYPT_HOST=api.shareaudio.cc
            - LETSENCRYPT_EMAIL=kacperczochara@gmail.com
        volumes:
            - ./_data:/api/_data
            - ./_uploads:/api/_uploads
        env_file:
            - .env.production
        ports:
            - "127.0.0.1:9010:8081"

    frontend:
        image: gcr.io/audio-274519/frontend:v1.0.3
        container_name: frontend
        restart: unless-stopped
        environment: 
            - VIRTUAL_HOST=shareaudio.cc
            - LETSENCRYPT_HOST=shareaudio.cc
            - LETSENCRYPT_EMAIL=kacperczochara@gmail.com
        ports:
            - "127.0.0.1:9011:80"

    wwwfrontend:
        image: nginx:stable-alpine
        container_name: wwwfrontend
        restart: unless-stopped
        environment:
            - VIRTUAL_HOST=www.shareaudio.cc
            - LETSENCRYPT_HOST=www.shareaudio.cc
            - LETSENCRYPT_EMAIL=kacperczochara@gmail.com
        volumes:
            - ./wwwfrontend.conf:/etc/nginx/conf.d/default.conf
        ports:
            - "127.0.0.1:9012:80"

    static:
        image: gcr.io/audio-274519/static:v1.0.1
        container_name: static
        restart: unless-stopped
        environment: 
            - VIRTUAL_HOST=static.shareaudio.cc
            - LETSENCRYPT_HOST=static.shareaudio.cc
            - LETSENCRYPT_EMAIL=kacperczochara@gmail.com
        volumes:
            - ./_uploads:/var/www
        ports: 
            - "127.0.0.1:9013:80"

